<html>
  <head>
    <!-- Imports -->
    <meta charset="UTF-8" />

    <!-- Open Layers -->
    <link rel="stylesheet" type="text/css" href="./css/ol.css" />
    <script type="text/javascript" src="./js/ol.js"></script>

    <!-- JavaScript Bundle with Popper -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"
      integrity="sha512-7JJuAfpfZHWvpo+Fd6W8x+b1/ECNdgfMsG+OoJOAR8dKIHrwszNnZdLQaw+nvRfX9ZHJn1ucy3q5m5/Z8smGpg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.10.2/umd/popper.min.js"
      integrity="sha512-Plh5C5l5yoh+5r5JhOOfWOkDeJ7wPy1c4nq3FzPAMoJ6mSDU6aA2mHxE+6kTQ1ZwU/XTzNvEeG19fij33V9EBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script
      src="https://kit.fontawesome.com/3e7d9b841e.js"
      crossorigin="anonymous"
    ></script>

    <!-- SplashScreen Styling -->
    <!-- <link
      rel="stylesheet"
      type="text/css"
      href="./css/splash_screen_style.css"
    /> -->

    <!-- HMI -->
    <link rel="stylesheet" href="./css/HMI_style.css" type="text/css" />
    <script type="text/javascript" src="./js/audio.js"></script>
    <script type="module" src="./js/HMI.js"></script>
    <script type="text/javascript" src="./js/animation.js"></script>
    <script type="module" src="./js/HMI-utils.js"></script>

    <!-- End Imports -->
    <title>Echo | Welcome</title>
  </head>

  <body style="margin: 0px !important">
    <div id="basemap" onclick="{openNav}"></div>
    <div id="header">
      <h1>Project Echo</h1>
    </div>
    <div class="hamburger">
      <button class="hamburger__button">
        <span class="hamburger__icon"></span>
      </button>
    </div>
    <div class="menu"></div>
    <button class="filter-btn my-button" title="Filter map">
      <i class="fas fa-filter"></i>
    </button>
    <div class="filter-menu"></div>
    <button class="simulator-btn my-button" title="Simulator - Simulate events">
      <i class="fa-solid fa-snowflake"></i>
    </button>
    <button class="setting-btn my-button" title="Settings">
      <i class="fa-solid fa-gear"></i>
    </button>

    <script>
      const hamburger = document.querySelector(".hamburger__button");
      const menu = document.querySelector(".menu");
      const filter = document.querySelector(".filter-btn");
      const filter_menu = document.querySelector(".filter-menu");

      hamburger.addEventListener("click", function () {
        this.parentNode.classList.toggle("is-active");
        menu.classList.toggle("is-active");
      });

      filter.addEventListener("click", function () {
        this.parentNode.classList.toggle("is-active");
        filter_menu.classList.toggle("is-active");
      });

      var overlay = null;
      function openFAQ() {
        if (overlay) {
          closeOverlay(overlay);
        }
        console.log("FAQ: ", document.getElementById("FAQ"));
        document.getElementById("FAQ").style.width = "100%";
        document.getElementById("FAQ").style.height = "100%";
        overlay = "OpenFAQ";
      }

      function closeFAQ() {
        document.getElementById("FAQ").style.width = "0%";
        document.getElementById("FAQ").style.height = "0%";
        overlay = null;
      }

      function openABOUT() {
        if (overlay) {
          closeOverlay(overlay);
        }
        document.getElementById("ABOUT").classList.add("active");
        console.log("OPEN ABOUT: ", document.getElementById("ABOUT"));
        document.getElementById("ABOUT").style.width = "100%";
        document.getElementById("ABOUT").style.height = "100%";
        overlay = "OpenABOUT";
      }

      function closeABOUT() {
        console.log("CLOSING THE ABOUT PAGE...");

        document.getElementById("ABOUT").style.width = "0%";
        document.getElementById("ABOUT").style.height = "0%";
        overlay = null;
      }

      function closeOverlay(overlay) {
        console.log("Closing Overlay: ", overlay);

        if (overlay == "OpenFAQ") {
          closeFAQ();
        } else if (overlay == "OpenABOUT") {
          closeABOUT();
        }
      }

      function openSIMULATOR() {
        if (overlay) {
          closeOverlay(overlay);
        }
        console.log("Opening Simulator...");
      }

      function openNav() {
        console.log("menuPanel: ", document.getElementById("menuPanel"));
        document.getElementById("menuPanel").style.width = "30%";
      }

      function closeNav() {
        document.getElementById("menuPanel").style.width = "0";
      }

      let aud = 0;
      function playAudio() {
        if (aud == 0) {
          document.getElementsByTagName("audio")[0].play();
          aud++;
          document.querySelector("i").style.opacity = "1";
        } else {
          document.querySelector("audio").pause();
          aud--;
          document.querySelector("i").style.opacity = ".5";
        }
      }
    </script>

    <script>
      //import { updateLayers } from "./js/HMI.js";
      //selecting the .form-check-input class (all the filter checkboxes fall under this class)
      const myClass = document.querySelectorAll(".form-check-input");

      //An array to store the ID for each checkbox
      const checkboxIDs = [];

      //Populating the checkbox
      myClass.forEach((element) => {
        console.log("doingsomething");
        checkboxIDs.push(element.id);
      });

      //init variable is set to true before the user has selected any filter options
      //before a user has checked any filter options, all layers will appear on screen
      let filterState = [...checkboxIDs];
      console.log(filterState, "FilterState:  ");
      console.log(checkboxIDs);

      function updateFilter(checkbox) {
        if (document.getElementById(checkbox).checked) {
          if (!filterState.includes(checkbox)) {
            filterState.push(checkbox);
          }
        } else {
          let index = filterState.indexOf(checkbox);
          if (index > -1) {
            filterState.splice(index, 1);
          }
        }
        console.log("Current filter state:  ", filterState);
        updateLayers(filterState);
      }

      // Get all the dropdowns on the page
      const dropdowns = document.querySelectorAll(".dropdown");

      // Add a click event listener to each dropdown
      dropdowns.forEach((dropdown) => {
        const button = dropdown.querySelector(".dropdown-toggle");
        const menu = dropdown.querySelector(".dropdown-menu");
        const inputs = dropdown.querySelectorAll(".form-check-input");

        // Toggle the 'show' class on the menu and button when clicked
        button.addEventListener("click", () => {
          menu.classList.toggle("show");
          button.classList.toggle("show");
        });
      });
    </script>

    <script type="module">
      import { updateLayers } from "./js/HMI.js";
      window.updateLayers = updateLayers;
    </script>

    <script type="module">
      import { initialiseHMI } from "./js/HMI.js";

      //All global state based info is stored in the hmiState
      let hmiState = {};
      window.hmiState = hmiState;

      //Basemap config
      //pls do not change origin lat long, these are set to target wild otways region
      hmiState.originLat = -38.813;
      hmiState.originLon = 143.537;
      hmiState.defaultZoom = 13;
      hmiState.requestInterval = 1000;

      const microphoneLocations = [
        { lat: -38.808, lon: 143.554 },
        { lat: -38.813, lon: 143.537 },
        { lat: -38.794, lon: 143.52 },
        { lat: -38.824, lon: 143.51 },
        { lat: -38.812, lon: 143.573 },
      ];
      /*
      const vocalizationLocations = [
        {eventID: 1, timestamp: 2349873234, detectingmicID:1, detectingMicLat: 43.132413, detectingMicLon: 25.235235, speciesScientificName: "Tawny Frogmouth", speciesIdentificationConfidence: 90.98, locationLat:-38.71 ,locationLon:143.000 , locationConfidence:90.98 , animalType:"bird", animalStatus:"normal" ,animalDiet: "omnivore" },
        {eventID: 1, timestamp: 2349873234, detectingmicID:1, detectingMicLat: 43.132413, detectingMicLon: 25.235235, speciesScientificName: "Wild boar", speciesIdentificationConfidence: 90.98, locationLat:-38.808 ,locationLon:143.8 , locationConfidence:90.98 , animalType:"amphibian", animalStatus:"invasive" ,animalDiet: "omnivore" },
        {eventID: 1, timestamp: 2349873234, detectingmicID:1, detectingMicLat: 43.132413, detectingMicLon: 25.235235, speciesScientificName: "Red fox", speciesIdentificationConfidence: 90.98, locationLat:-38.89 ,locationLon:142.554 , locationConfidence:90.98 , animalType:"mammal", animalStatus:"endangered" ,animalDiet: "omnivore" },
        {eventID: 1, timestamp: 2349873234, detectingmicID:1, detectingMicLat: 43.132413, detectingMicLon: 25.235235, speciesScientificName: "Redeye", speciesIdentificationConfidence: 90.98, locationLat:-38.608 ,locationLon:143.254 , locationConfidence:90.98 , animalType:"insect", animalStatus:"near threatened" ,animalDiet: "omnivore" },
        {eventID: 1, timestamp: 2349873234, detectingmicID:1, detectingMicLat: 43.132413, detectingMicLon: 25.235235, speciesScientificName: "Brown Rat", speciesIdentificationConfidence: 90.98, locationLat:-38.508 ,locationLon:141.87 , locationConfidence:90.98 , animalType:"reptile", animalStatus:"vulnerable" ,animalDiet: "omnivore" },
      ];
*/

      const trueLocations = [
        {
          eventID: 1,
          timestamp: 2349873234,
          detectingmicID: 1,
          detectingMicLat: 43.132413,
          detectingMicLon: 25.235235,
          speciesScientificName: "Tawny Frogmouth",
          speciesIdentificationConfidence: 100,
          locationLat: -38.81905478815439,
          locationLon: 143.524,
          locationConfidence: 100,
          animalType: "bird",
          animalStatus: "normal",
          animalDiet: "omnivore",
        },
        {
          eventID: 1,
          timestamp: 2349873234,
          detectingmicID: 1,
          detectingMicLat: 43.132413,
          detectingMicLon: 25.235235,
          speciesScientificName: "Wild boar",
          speciesIdentificationConfidence: 100,
          locationLat: -38.80166562762367,
          locationLon: 143.54,
          locationConfidence: 100,
          animalType: "amphibian",
          animalStatus: "invasive",
          animalDiet: "omnivore",
        },
        {
          eventID: 1,
          timestamp: 2349873234,
          detectingmicID: 1,
          detectingMicLat: 43.132413,
          detectingMicLon: 25.235235,
          speciesScientificName: "Red fox",
          speciesIdentificationConfidence: 100,
          locationLat: -38.82166562762367,
          locationLon: 143.55,
          locationConfidence: 100,
          animalType: "mammal",
          animalStatus: "endangered",
          animalDiet: "omnivore",
        },
        //{eventID: 1, timestamp: 2349873234, detectingmicID:1, detectingMicLat: 43.132413, detectingMicLon: 25.235235, speciesScientificName: "Redeye", speciesIdentificationConfidence: 100, locationLat:-38.80066562762367 ,locationLon:143.555 , locationConfidence:100 , animalType:"insect", animalStatus:"near threatened" ,animalDiet: "omnivore" },
        {
          eventID: 1,
          timestamp: 2349873234,
          detectingmicID: 1,
          detectingMicLat: 43.132413,
          detectingMicLon: 25.235235,
          speciesScientificName: "Brown Rat",
          speciesIdentificationConfidence: 100,
          locationLat: -38.80266562762367,
          locationLon: 143.56,
          locationConfidence: 100,
          animalType: "reptile",
          animalStatus: "vulnerable",
          animalDiet: "omnivore",
        },
      ];

      hmiState.trueLocations = trueLocations;
      //hmiState.vocalizationLocations = vocalizationLocations;
      hmiState.microphoneLocations = microphoneLocations;
      initialiseHMI(hmiState);

      const el = (sel) => {
        return document.getElementById(sel);
      };
      const elArea = el("basemap");
      // const elPopup = el("popup");
      const elPopup = el("menuPanel");
      const faqOl = el("nav-faq");
      const aboutOl = el("nav-about");
      const simulatorOl = el("nav-simulator");
      //Add popup message at anywhere in map
      // const showPopup = (evt) => {
      // 	const elBtn = evt.currentTarget;
      // 	Object.assign(elPopup.style, {
      // 		left: `${evt.pageX + elBtn.scrollLeft - elBtn.offsetLeft - 320}px`,
      // 		top:  `${evt.pageY + elBtn.scrollTop - elBtn.offsetTop - 180}px`,
      // 		display: `block`,
      // 	});
      // };
      simulatorOl.addEventListener("click", openSIMULATOR);
      aboutOl.addEventListener("click", openABOUT);
      elArea.addEventListener("click", openNav);
      faqOl.addEventListener("click", openFAQ);
      //Add sound listener to icon
      // let a=0;
      // document.getElementsByTagName("i")[0].addEventListener("click",function(){
      // 	if(a==0){
      // 		document.getElementsByTagName("audio")[0].play();
      // 		a++;
      // 		document.querySelector("i").style.opacity="1";
      // 	} else {
      // 		document.querySelector("audio").pause();
      // 		a--;
      // 		document.querySelector("i").style.opacity=".5";
      // 	}
      // });
    </script>
  </body>
</html>
